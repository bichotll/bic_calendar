/*
 *  Bic Calendar - v3.2.2
 *  A simple twitter bootstrap calendar / agenda to mark events and select range of dates.
 *  http://bichotll.github.io/bic_calendar
 *
 *  Made by bichotll
 *  Under Apache License
 */ 
$.fn.bic_calendar=function(w){var b=$.extend({},$.fn.bic_calendar.defaults,w);this.each(function(){function t(a,e){q.empty();z();A(a,e);B(a,e);x()}function z(){if(0!=C){var a=$('<tr class="days-month" >'),e="";$(D).each(function(a,d){e+="<td";0==a&&(e+=' class="first"');6==a&&(e+=' class="sunday last"');e+=">"+d+"</td>"});e+="</tr>";a.append(e);q.append(a)}}function A(a,e){E.text(F[a]);G.text(e);var b=1,d;d=(new Date(e,a,1)).getDay();d+=H;0==d?d=6:d--;var f;for(f=28;w(a+1,f+1,e);)f++;for(var h=a+ 1,l="",g=0;7>g;g++){if(g<d){var c="";0==g&&(c+="<tr>");c+='<td class="invalid-day week-day-'+g+'"';c+='"></td>'}else c="",0==g&&(c+="<tr>"),c+='<td id="bic_calendar_'+b+"_"+h+"_"+e+'" data-date="'+h+"/"+b+"/"+e+'" ',c+=' class="day week-day-'+g+'"',c+="><div><a>"+b+"</a></div></span>",6==g&&(c+="</tr>"),b++;l+=c}for(d=1;b<=f;)c="",1==d%7&&(c+="<tr>"),c+='<td id="bic_calendar_'+b+"_"+h+"_"+e+'" data-date="'+h+"/"+b+"/"+e+'" ',c+=' class="day week-day-'+(d-1)%7+'"',c+="><div><a>"+b+"</a></div></td>", 0==d%7&&(c+="</tr>"),b++,d++,l+=c;d--;if(0!=d%7)for(g=d%7+1;7>=g;g++)c="",c+="<td ",c+=' class="invalid-day week-day-'+(g-1)+'"',c+='"></td>',7==g&&(c+="</tr>"),l+=c;q.append(l)}function w(a,e,b){return 0<a&&13>a&&0<b&&32768>b&&0<e&&e<=(new Date(b,a,0)).getDate()}function B(a,e){0!=u?$.ajax({type:u.type,url:u.url,data:{mes:a+1,ano:e},dataType:"json"}).done(function(b){"undefined"==typeof f&&(f=[]);$.each(b,function(a,e){f.push(b[a])});I(a,e)}):I(a,e)}function I(a,e){for(var b=a+1,d=0;d<f.length;d++)if(f[d].date.split("/")[1]== b&&f[d].date.split("/")[2]==e){var k=$("#bic_calendar_"+f[d].date.replace(/\//g,"_")),h=$("#bic_calendar_"+f[d].date.replace(/\//g,"_")+" a");k.addClass("event");h.attr("data-original-title",f[d].title);f[d].color&&k.css("background",f[d].color);"undefined"!=typeof f[d].link&&""!=f[d].link&&h.attr("href",f[d].link);"undefined"!=typeof f[d].linkTarget&&""!=f[d].linkTarget&&h.attr("target",f[d].linkTarget);f[d]["class"]&&k.addClass(f[d]["class"]);f[d].content?(k.addClass("event_popover"),h.attr("rel", "popover"),h.attr("data-content",f[d].content)):(k.addClass("event_tooltip"),h.attr("rel","tooltip"))}$("#bic_calendar .event_tooltip a").tooltip(J);$("#bic_calendar .event_popover a").popover(K);$(".manual_popover").click(function(){$(this).popover("toggle")})}function P(){if(1==L)r.on("click","td.day",function(){if(1==M)if(""==n)n=$(this).data("date"),x();else if(""==p){m=n;p=$(this).data("date");x();var a=new CustomEvent("bicCalendarSelect",{detail:{dateFirst:m,dateLast:p}});document.dispatchEvent(a)}else n= p=m="",r.find(".selection").removeClass("middle-selection selection first-selection last-selection");else r.find("td div").removeClass("selection"),$(this).find("div").addClass("selection"),a=new CustomEvent("bicCalendarSelect",{detail:{date:$(this).data("date")}}),document.dispatchEvent(a)})}function x(){if(""!=n&&""==m){var a=n.split("/");$("#bic_calendar_"+a[1]+"_"+a[0]+"_"+a[2]+" div").addClass("selection")}else if(""!=m){m.split("/");p.split("/");r.find("td.selection").removeClass("selection"); var a=new Date(m),e=new Date(p);if(a>e)var b=a,a=e,e=b;for($("#bic_calendar_"+a.getDate()+"_"+(parseInt(a.getMonth())+1)+"_"+a.getFullYear()+" div").addClass("selection first-selection");a<e;)a.setDate(a.getDate()+1),$("#bic_calendar_"+a.getDate()+"_"+(parseInt(a.getMonth())+1)+"_"+a.getFullYear()+" div").addClass("selection middle-selection");$("#bic_calendar_"+a.getDate()+"_"+(parseInt(a.getMonth())+1)+"_"+a.getFullYear()+" div").removeClass("middle-selection").addClass("selection last-selection")}} var r=$(this),v,q,E=$('<div class="visualmonth"></div>'),G=$('<div class="visualyear"></div>'),f=b.events;$.each(f,function(a,e){var b=e.date.split("/"),d=parseInt(b[0]),k=parseInt(b[1]);e=d+"/"+k+"/"+b[2];f[a].date=e});var s;if(b.date)if("string"==typeof b.date){var y=b.date.split("/");s=new Date(parseInt(y[2]),parseInt(y[1])-1,parseInt(y[0]))}else s=b.date;else s=new Date;var D;D="undefined"!=typeof b.dayNames?b.dayNames:"lmxjvsd".split("");var F;F="undefined"!=typeof b.monthNames?b.monthNames: "Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre".split(" ");var C;C="undefined"!=typeof b.showDays?b.showDays:!0;var K;K="undefined"!=typeof b.popoverOptions?b.popoverOptions:{placement:"bottom",html:!0,trigger:"hover"};var J;J="undefined"!=typeof b.tooltipOptions?b.tooltipOptions:{placement:"bottom",trigger:"hover"};var u;u="undefined"!=typeof b.reqAjax?b.reqAjax:!1;var L=!1;"undefined"!=typeof b.enableSelect&&(L=b.enableSelect);var M=!1;"undefined"!=typeof b.multiSelect&& (M=b.multiSelect);var N=!0;"undefined"!=typeof b.displayMonthController&&(N=b.displayMonthController);var O=!0;"undefined"!=typeof b.displayYearController&&(O=b.displayYearController);var H=0;"undefined"!=typeof b.startWeekDay&&(H=b.startWeekDay);var m="",p="",n="";(function(){q=$('<table class="table">');z();var a=s.getMonth(),b=s.getFullYear();A(a,b);var f=$('<td><a href="#" class="button-month-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');f.click(function(c){c.preventDefault(); a=(a+1)%12;0==a&&b++;t(a,b)});var d=$('<td><a href="#" class="button-month-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');d.click(function(c){c.preventDefault();--a;-1==a&&(b--,a=11);t(a,b)});var k=$('<td><a href="#" class="button-year-next"><i class="glyphicon glyphicon-arrow-right" ></i></a></td>');k.click(function(c){c.preventDefault();b++;t(a,b)});var h=$('<td><a href="#" class="button-year-previous"><i class="glyphicon glyphicon-arrow-left" ></i></a></td>');h.click(function(c){c.preventDefault(); b--;t(a,b)});var l=$('<table class="table header"></table>');if(!0===O){var g=$("<tr></tr>"),c=$('<td colspan=5 class="monthAndYear span6"></td>');g.append(h);g.append(c);g.append(k);c.append(G);l.append(g)}!0===N&&(k=$("<tr></tr>"),h=$('<td colspan=5 class="monthAndYear span6"></td>'),k.append(d),k.append(h),k.append(f),h.append(E),l.append(k));v=$('<div class="bic_calendar row" id="bic_calendar" ></div>');v.prepend(l);v.append(q);r.append(v);B(a,b);P()})()});return this};